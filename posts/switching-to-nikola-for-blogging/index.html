<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Switching to nikola for blogging | wrouesnel_blog</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://blog.wrouesnel.com/posts/switching-to-nikola-for-blogging/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Will Rouesnel">
<link rel="prev" href="../setting-a-separate-pattern-lock-and-encryption-password-on-android/" title="Setting a separate encryption password and pattern lock on Android" type="text/html">
<meta property="og:site_name" content="wrouesnel_blog">
<meta property="og:title" content="Switching to nikola for blogging">
<meta property="og:url" content="https://blog.wrouesnel.com/posts/switching-to-nikola-for-blogging/">
<meta property="og:description" content="Why?¶The key to me for blogging is to keep it simple. This at first meant static sites that rendered nicely, and this was a function fulfilled by Wintersmith.
The Problems¶The problem with Wintersmith">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2021-12-09T20:59:29+11:00">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Header and menu bar -->
<div class="container">
      <header class="blog-header py-3"><div class="row nbb-header align-items-center">
          <div class="col-md-3 col-xs-2 col-sm-2" style="width: auto;">
            <button class="navbar-toggler navbar-light bg-light nbb-navbar-toggler" type="button" data-toggle="collapse" data-target=".bs-nav-collapsible" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse bs-nav-collapsible bootblog4-search-form-holder">
                
            </div>
        </div>
          <div class="col-md-6 col-xs-10 col-sm-10 bootblog4-brand" style="width: auto;">
            <a class="navbar-brand blog-header-logo text-dark" href="../../">

            <span id="blog-title">wrouesnel_blog</span>
        </a>
          </div>
            <div class="col-md-3 justify-content-end align-items-center bs-nav-collapsible collapse flex-collapse bootblog4-right-nav">
            <nav class="navbar navbar-light bg-white"><ul class="navbar-nav bootblog4-right-nav"></ul></nav>
</div>
    </div>
</header><nav class="navbar navbar-expand-md navbar-light bg-white static-top"><div class="collapse navbar-collapse bs-nav-collapsible" id="bs-navbar">
            <ul class="navbar-nav nav-fill d-flex w-100">
<li class="nav-item">
<a href="../../archive.html" class="nav-link">Archive</a>
                </li>
<li class="nav-item">
<a href="../../categories/" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="../../rss.xml" class="nav-link">RSS feed</a>

                
            </li>
</ul>
</div>
<!-- /.navbar-collapse -->
</nav>
</div>

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Switching to nikola for blogging</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/will-rouesnel/">Will Rouesnel</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2021-12-09T20:59:29+11:00" itemprop="datePublished" title="2021-12-09 20:59">2021-12-09 20:59</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Why?">Why?<a class="anchor-link" href="#Why?">¶</a>
</h2>
<p>The key to me for blogging is to keep it simple. This at first meant static sites that rendered nicely, and this was a function fulfilled by Wintersmith.</p>
<h2 id="The-Problems">The Problems<a class="anchor-link" href="#The-Problems">¶</a>
</h2>
<p>The problem with Wintersmith was that it was a pure markdown solution. At the end of the day, it turned out that most of what I wanted to talk about probably had some type of interactive or graphical component to it, or I just wanted to be able to add photos and images easily.</p>
<p>None of this is easy with pure markdown.</p>
<h2 id="The-Solution">The Solution<a class="anchor-link" href="#The-Solution">¶</a>
</h2>
<p>The new solution for me here is Nikola which seems to hit a new sweetspot of codeability versus low friction. Specifcially it's support for posts being rendered out of jupter-lab notebooks, something that I've had just grow in usefulness.</p>
<h2 id="Perceived-Benefits">Perceived Benefits<a class="anchor-link" href="#Perceived-Benefits">¶</a>
</h2>
<p>Getting the transition from "jupyter notebook" to "blog" post down to as frictionless as possible feels important. When you want to share neat stuff about code, it helps to do it right next to the neat code you just wrote.</p>
<p>When you want to share data analysis - well that's a jupyter specialty. And when you want to show off something you're doing in your workshop, then at the very least pulling in some images with jupyter is a bit more practical and probably a lot more likely to be low enough effort that I'll do it - this last part is the bit that's definitely up in the air here.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Workarounds">Workarounds<a class="anchor-link" href="#Workarounds">¶</a>
</h2>
<h3 id="Keeping-media-and-posts-together">Keeping media and posts together<a class="anchor-link" href="#Keeping-media-and-posts-together">¶</a>
</h3>
<p>The first problem I ran into with Nikola is that it and I disagree on how to structure posts.</p>
<p>Namely: out of the box Nikola has the notion of separate <code>/images</code> <code>/files</code> and <code>/posts</code> (or <code>/pages</code>) directories for determining content.</p>
<p>I don't like this, and it has a practical downside: when working on a Jupyter notebook for a post, suppose it requires data or I'm using some tool which will do drag and drop images for me? What I'd like is to open that notebook, and just that notebook in Jupyter or VSCode and work on just that file - including how I reference data.</p>
<p>Although <a href="https://github.com/getnikola/nikola/issues/2266">this issue</a> suggests a workaround, it has a of drawbacks. But more importantly - one of the reasons we use Nikola is it's written in Python, and better - it's main configuration file <code>conf.py</code> is itself, runnable Python.</p>
<p>This gives us a much better solution: we can just generate our post finding logic at config time.</p>
<p>To do this we need to find this stanza:</p>
<div class="highlight"><pre><span></span><span class="n">POSTS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="s2">"posts/*.ipynb"</span><span class="p">,</span> <span class="s2">"posts"</span><span class="p">,</span> <span class="s2">"post.tmpl"</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">"posts/*.rst"</span><span class="p">,</span> <span class="s2">"posts"</span><span class="p">,</span> <span class="s2">"post.tmpl"</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">"posts/*.md"</span><span class="p">,</span> <span class="s2">"posts"</span><span class="p">,</span> <span class="s2">"post.tmpl"</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">"posts/*.txt"</span><span class="p">,</span> <span class="s2">"posts"</span><span class="p">,</span> <span class="s2">"post.tmpl"</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">"posts/*.html"</span><span class="p">,</span> <span class="s2">"posts"</span><span class="p">,</span> <span class="s2">"post.tmpl"</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
<p>This is a pretty standard stanza which configures how posts are located. Importantly: the wildcard here isn't a regular glob, and all these paths act recursive searches, with the directory names winding up in our paths (i.e. <code>posts/some path with spaces/mypost.ipynb</code> winds up as <code>https://yoursite/posts/some path with spaces/mypost-name-from-metadata</code>)</p>
<p>So what do we want to have happen?</p>
<p>Ideally we want something like this to work:</p>

<pre><code>|-my-post/- my-post.ipynb
         |- images/some-image.jpg
         |- files/data_for_the_folder.tsv</code></pre>
<p>and then on the output it should end up in a sensible location.</p>
<p>We can do this by calculating all these paths at compile time in the config file, to workaround the default behavior.</p>
<p>So for our POSTS element we use this dynamic bit of Python code:</p>
<div class="highlight"><pre><span></span><span class="c1"># Calculate POSTS so they must follow the convention &lt;post-name&gt;/&lt;post-name&gt;.&lt;supported extension&gt;</span>
<span class="n">_post_exts</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">"ipynb"</span><span class="p">,</span>
    <span class="s2">"rst"</span><span class="p">,</span>
    <span class="s2">"md"</span><span class="p">,</span>
    <span class="s2">"txt"</span><span class="p">,</span>
    <span class="s2">"html"</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">_posts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">_root_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span><span class="s2">"posts"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">_root_dir</span><span class="p">):</span>
    <span class="n">fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_root_dir</span><span class="p">,</span><span class="n">e</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
        <span class="k">continue</span>
    <span class="n">_postmatchers</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">"."</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">"posts"</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">e</span><span class="p">),</span><span class="n">ext</span><span class="p">))</span> <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">_post_exts</span> <span class="p">]</span>
    <span class="n">_posts</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s2">"posts"</span><span class="p">,</span> <span class="s2">"post.tmpl"</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">_postmatchers</span> <span class="p">])</span>

<span class="n">POSTS</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">_posts</span><span class="p">)</span>

<span class="n">PAGES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="s2">"pages/*.ipynb"</span><span class="p">,</span> <span class="s2">"posts"</span><span class="p">,</span> <span class="s2">"page.tmpl"</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">"pages/*.rst"</span><span class="p">,</span> <span class="s2">"pages"</span><span class="p">,</span> <span class="s2">"page.tmpl"</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">"pages/*.md"</span><span class="p">,</span> <span class="s2">"pages"</span><span class="p">,</span> <span class="s2">"page.tmpl"</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">"pages/*.txt"</span><span class="p">,</span> <span class="s2">"pages"</span><span class="p">,</span> <span class="s2">"page.tmpl"</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">"pages/*.html"</span><span class="p">,</span> <span class="s2">"pages"</span><span class="p">,</span> <span class="s2">"page.tmpl"</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
<p>Testing this - it works. It means we can keep our actual post bodies, and any supporting files, nicely organized.</p>
<p>Now there's two additional problems: <code>images</code> and <code>files</code>. We'd like to handle <code>images</code> specially because Nikola will do automatic thumbnailing and resizing for us in our posts. They're handled lossily. Whereas <code>files</code> are not touched at all in the final output.</p>
<p>The solution I settled on is just to move these paths to under <code>images</code> and <code>files</code> adjacent to the posts respectfully. This means is the Jupyter notebook I'm using is referencing data, it's reasonably well behaved.</p>
<p>For files we use this config stanza:</p>
<div class="highlight"><pre><span></span><span class="n">FILES_FOLDERS</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'files'</span><span class="p">:</span> <span class="s1">'files'</span><span class="p">}</span>

<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">_root_dir</span><span class="p">):</span>
    <span class="n">fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_root_dir</span><span class="p">,</span><span class="n">e</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
        <span class="k">continue</span>
    <span class="n">FILES_FOLDERS</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span><span class="s2">"files"</span><span class="p">)]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">"posts"</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="s2">"files"</span><span class="p">)</span>
</pre></div>
<p>and for images we use this:</p>
<div class="highlight"><pre><span></span><span class="n">IMAGE_FOLDERS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"images"</span><span class="p">:</span> <span class="s2">"images"</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">_root_dir</span><span class="p">):</span>
    <span class="n">fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_root_dir</span><span class="p">,</span><span class="n">e</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
        <span class="k">continue</span>
    <span class="n">IMAGE_FOLDERS</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span><span class="s2">"images"</span><span class="p">)]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">"posts"</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="s2">"images"</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Setting-up-the-publish-workflow">Setting up the publish workflow<a class="anchor-link" href="#Setting-up-the-publish-workflow">¶</a>
</h3>
<p>Nikola comes out of the box with a publishing workflow for Github pages, which is where I host this blog.</p>
<p>Since I've switched over to running decentralized with my git repos stored in syncthing, I wanted to ensure I only pushed the content of this blog and kept the regular repo on my local systems since it leads to an easier drafting experience.</p>
<p>I configure the github publish workflow like so in <code>conf.py</code>:</p>
<div class="highlight"><pre><span></span><span class="n">GITHUB_SOURCE_BRANCH</span> <span class="o">=</span> <span class="s2">"src"</span>
<span class="n">GITHUB_DEPLOY_BRANCH</span> <span class="o">=</span> <span class="s2">"master"</span>

<span class="c1"># The name of the remote where you wish to push to, using github_deploy.</span>
<span class="n">GITHUB_REMOTE_NAME</span> <span class="o">=</span> <span class="s2">"publish"</span>

<span class="c1"># Whether or not github_deploy should commit to the source branch automatically</span>
<span class="c1"># before deploying.</span>
<span class="n">GITHUB_COMMIT_SOURCE</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
<p>and then add my Github repo as the remote named <code>publish</code> as</p>

<pre><code>git remote add publish https://github.com/wrouesnel/wrouesnel.github.io.git</code></pre>
<p>and then synchronize my old blog so nikola can take it over:</p>

<pre><code>git fetch publish
git checkout master
find -depth -delete
git commit -m "Transition to Nikola"
git checkout main</code></pre>
<p>and then finally just do the deploy:</p>

<pre><code>nikola github_deploy</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Next-Steps">Next Steps<a class="anchor-link" href="#Next-Steps">¶</a>
</h2>
<p>This isn't perfect, but it's a static site and it looks okay and that's good enough.</p>
<p>I've got a few things I want to fix:</p>
<ul>
<li>presentation of jupyter notebooks - I'd like it to look seamless to "writing things in Markdown"</li>
<li>a tag line under the blog title - the old site had it, the new one should have it.</li>
<li>using <code>nikola new_post</code> with this system probably doesn't put the new file anywhere sensible - it would be nice if it did</li>
<li>figure out how I want to use galleries</li>
</ul>
</div>
</div>
</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../setting-a-separate-pattern-lock-and-encryption-password-on-android/" rel="prev" title="Setting a separate encryption password and pattern lock on Android">Previous post</a>
            </li>
        </ul></nav></aside><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha384-3lJUsx1TJHt7BA4udB5KPnDrlkO8T6J6v/op7ui0BbCjvZ9WqV4Xm6DTP6kQ/iBH" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
        MathJax.Hub.Config({tex2jax: {inlineMath: [['$latex ','$'], ['\\(','\\)']]}});
        </script></article><!--End of body content--><footer id="footer">
            Contents © 2021         <a href="mailto:wrouesnel@wrouesnel.com">Will Rouesnel</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
            
        </footer>
</div>
</div>


        <script src="../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
