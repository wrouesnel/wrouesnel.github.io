<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <script type="text/javascript">
      // google analytics
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-43235370-1', 'wrouesnel.github.io');
      ga('send', 'pageview');
    </script>
    <title>wrouesnel_blog
    </title>
    <link rel="alternate" href="http://localhost:8080/feed.xml" type="application/rss+xml" title="negating information entropy">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic|Anonymous+Pro:400,700,400italic,700italic|Merriweather:400,700,300">
    <link rel="stylesheet" href="/css/main.css">
  </head>
  <body>
    <header class="header">
      <div class="content-wrap">
        <div class="logo">
          <h1><a href="http://localhost:8080">wrouesnel_blog</a></h1>
          <p class="description">negating information entropy</p>
        </div>
      </div>
    </header>
    <div id="content">
      <div class="content-wrap">
        <!-- First article - render in full-->
        <article class="article intro"></article>
        <header>
          <h1 class="indexfullarticle"><a href="/articles/Flashing%20Marlin%20with%20Eclipse%20and%20AVRDude/">Flashing Marlin with Eclipse and AVR Dude</a></h1>
          <div class="date"><span>23. April 2014</span></div>
          <p class="author"><span class="author"><a href="mailto:w.rouesnel@gmail.com">Will Rouesnel</a></span>
          </p>
        </header>
        <section class="content"><h1>Intro</h1>
<p>3D printing is still very much in the hobbyist stage, and I am a tinkerer at heart. So flashing my printer&#39;s firmware is a basic operation - in fact it has to be a basic operation, since most configuration changes are baked into the&nbsp;firmware.</p>
<p>But, I run my printer at 250000 baud rate over <span class="caps">USB</span>. This is an excellent choice for printing since the error rate from the serial line on the Arduino is basically 0, and it&#39;s faster to boot. Excellent for rapid G-code&nbsp;sending.</p>
<p>But it can make reprogramming using the standard Arduino <span class="caps">IDE</span> a bit of a pain, and by and large I don&#39;t like the standard Arduino&nbsp;IDE.</p>
<p>The problem is that your Arduino in 3D printing mode is running at a non-standard baudrate. Linux can handle this just fine, as can the underlying programming tool of Arduino <code>avrdude</code>, but the <span class="caps">IDE</span> doesn&#39;t let you just type in what you need. Eclipse does. Get the latest version of AVRdude you can, since it makes things <em>a lot</em> easier - I have 6.0.1 which is built into Ubuntu “Trusty&nbsp;Tahr”.</p>
<h1>Reprogramming with&nbsp;Eclipse</h1>
<p>People have covered setting up Eclipse for Arduino elsewhere, and I will in the future cover my setup in my own words (I believe understanding comes from finding an idea explained in the right voice a lot of the time) but for now I&#39;ll just say it works pretty&nbsp;well.</p>
<h1>Reprogramming an Arduino Mega 2560 (or&nbsp;compatible)</h1>
<p>The basic command line you need for the Arduino Mega when it&#39;s running at 250000 bps is very simple. The avrdude command should be <code>avrdude -cstk500v2 -P/dev/ttyACM0 -b250000</code> in Eclipse. You can enter this by typing in the baud rate directly in the drop down box - Eclipse will accept it just&nbsp;fine.</p>
<p>The AVRdude settings screen should look something like this when you&#39;re&nbsp;done:</p>
<p><img src="/articles/Flashing%20Marlin%20with%20Eclipse%20and%20AVRDude/eclipse-avrdude-screen.png" alt="AVRDude Configuration Screen"></p>
<p>The benefit of this configuration is your printer (or arduino for another project) can be easily reflashed without having to time-out resetting it so you can run AVRdude at one of the “standard”&nbsp;baudrates.</p>
<p>It&#39;s worth noting that by creating a custom <code>boards.txt</code> configuration it might be possible to accomplish this in the Arduino <span class="caps">IDE</span> as well, but Eclipse is a much easier to use dev-environment for big Arduino projects (like 3D printer firmwares) that I don&#39;t really have any inclination to avoid it in the future (plus is generalizes out to non-Arduino AVR programming&nbsp;nicely).</p>
<h1>Going&nbsp;further</h1>
<p>This is just a short “I did this a few minutes ago note”. In the future I&#39;ll detail my Arduino Eclipse workspace, to add to the signal to noise ratio on that&nbsp;subject.</p>
</section>
        <article class="article intro"></article>
        <header>
          <h2><a href="/articles/Uninstalling%20r8168-dkms/">Quick note - uninstalling r8618-dkms</a></h2>
          <div class="date"><span>30. January 2014</span></div>
          <p class="author"><span class="author"><a href="mailto:w.rouesnel@gmail.com">Will Rouesnel</a></span>
          </p>
        </header>
        <section class="content"><p>This is a quick note on something I encountered while trying to work out why my Realtek NICs are so finicky about connecting and staying connected at gigabit speeds when running&nbsp;Linux.</p>
<p>The current hypothesis is that the <code>r8168</code> driver isn&#39;t helping very much. So I uninstalled it - and ran into two&nbsp;problems.</p>

          <p class="more"><a href="/articles/Uninstalling%20r8168-dkms/">more</a></p>
        </section>
        <article class="article intro"></article>
        <header>
          <h2><a href="/articles/Running%20Gnome%20Tracker%20on%20a%20Server/">Running Gnome Tracker on a Server</a></h2>
          <div class="date"><span>25. January 2014</span></div>
          <p class="author"><span class="author"><a href="mailto:w.rouesnel@gmail.com">Will Rouesnel</a></span>
          </p>
        </header>
        <section class="content"><p>In a passing comment it was suggested to me that it would be really great if the home fileserver offered some type of web-interface to find things. We‘ve been aggregating downloaded files there for a while, and there’s been attempts made at categorization but this all really falls apart when you wonder “what does ‘productivity’ mean? And does this go under ‘Linux’ or some other&nbsp;thing?”</p>
<p>Since lately I‘ve been wanting to get desktop search working on my actual desktops, via Gnome’s Tracker project and it&#39;s tie-in to Nautilus and Nemo (possibly the subject of a future blog), it seemed logical to run it on the fileserver as an indexer for our shared directories - and then to tie some kind of web ui to&nbsp;that.</p>
<p>Unfortunately, Tracker is very desktop orientated - there&#39;s no easy daemon mode for running it on a headless system out-of-the-box, but with a little tweaking you <em>can</em> make it work for you quite&nbsp;easily.</p>
<h1>How&nbsp;to</h1>
<p>On my system I keep Tracker running as it&#39;s own user under a system account. On Ubuntu you need to create this like so (using a root shell - <code>sudo -i</code>):</p>
<pre><code class="lang-bash">$ adduser --system --shell=/bin/<span class="literal">false</span> --disabled-login --home=/var/lib/tracker tracker
$ adduser tracker root</code></pre>
<p>Since tracker uses GSettings for it&#39;s configuration these days, you need to su into the user you just created to actually configure the directories which should be indexed. Since this is a server, you probably just have a list of them so set it somewhat like the example below. Note: you must run the dbus-launch commands in order to have a viable session bus for dconf to work with. This will also be a requirement of Tracker later&nbsp;on.</p>
<pre><code class="lang-bash">$ su --shell /bin/bash
$ eval `dbus-launch --sh-syntax`
$ dconf write org/freedesktop/tracker/miner/files/index-recursive-directories <span class="string">"['/path/to/my/dir/1', '/path/to/my/dir/2', '/etc/etc']"</span>
$ kill <span class="variable">$DBUS_SESSION_BUS_PID</span>
$ <span class="keyword">exit</span></code></pre>
<p>Your Tracker user is now ready at this point. To start and stop the service, we use an <a href="/articles/Running%20Gnome%20Tracker%20on%20a%20Server/tracker.conf">Upstart script like the one below</a>:</p>
<pre><code class="lang-sh">description &quot;gnome tracker system startup script&quot;
author &quot;wrouesnel&quot;

start on (local-filesystems and net-device-up)
stop on shutdown

respawn
respawn limit 5 60

setuid tracker

script
    chdir /var/lib/tracker
    eval `dbus-launch --sh-syntax`
    echo $DBUS_SESSION_BUS_PID &gt; .tracker-sessionbus.pid
    echo $DBUS_SESSION_BUS_ADDRESS &gt; .tracker-sessionbus
    /usr/lib/tracker/tracker-store
end script

post-start script
    chdir /var/lib/tracker
    while [ ! -e .tracker-sessionbus ]; do sleep 1; done
    DBUS_SESSION_BUS_ADDRESS=$(cat .tracker-sessionbus) /usr/lib/tracker/tracker-miner-fs <span class="amp">&amp;</span>
end script

post-stop script 
    # We need to kill off the <span class="caps">DBUS</span> session here
    chdir /var/lib/tracker
    kill $(cat .tracker-sessionbus.pid)
    rm .tracker-sessionbus.pid
    rm .tracker-sessionbus
end script</code></pre>
<p>Some things to focus on about the script: we launch and save the DBus session parameters. We&#39;ll need these to reconnect to the session to run tracker related commands. The post-stop stanza is to kill off the DBus&nbsp;session.</p>
<p>You do need to explicitely launch <code>tracker-miner-fs</code> in order for file indexing to work, but you don&#39;t need to kill it explicitely - it will be automatically shutdown when Upstart kills <code>tracker-store</code>.</p>
<p>Also note that since tracker runs as the user <code>tracker</code> it can only index files and directories which it is allowed to traverse, so check your&nbsp;permissions.</p>
<p>You can now start Tracker as your user with <code>start tracker</code>. And stop it with <code>stop tracker</code>. Simple and&nbsp;clean.</p>
<h1>Using&nbsp;this</h1>
<p>My plan for this setup is to throw together a Node.js app on my server that will forward queries to the tracker command line client - that app will be a future post when it&#39;s&nbsp;done.</p>

        </section>
        <article class="article intro"></article>
        <header>
          <h2><a href="/articles/Migrating%20to%20Gmail/">Migrating to Gmail</a></h2>
          <div class="date"><span>12. November 2013</span></div>
          <p class="author"><span class="author"><a href="mailto:w.rouesnel@gmail.com">Will Rouesnel</a></span>
          </p>
        </header>
        <section class="content"><h1>Why</h1>
<p>In a stitch of irony given my prior articles wrestling with a decent <span class="caps">IDLE</span> daemon for use with getmail, I&#39;m faced with a new problem in figuring out the best way to migrate all my existing, locally hosted email to&nbsp;Gmail.</p>
<p>This is evidently not an uncommon problem for people, presumably for largely the same reasons I‘m facing: although I like having everything locally on my own server, it only works in places where (1) I live in the same place as the server and (2) where my server won’t be double-<span class="caps">NAT</span>&#39;d so dynamic DNS can actually reach&nbsp;it.</p>
<h1>How</h1>
<p>My personal email has been hosted on a Dovecot <span class="caps">IMAP</span> server in a Maildir up till now. Our tool of choice for this migration will be the venerable <a href="http://offlineimap.org/">OfflineIMAP</a> utility, available on Debian-ish systems with <code>apt-get install offlineimap</code>.</p>

          <p class="more"><a href="/articles/Migrating%20to%20Gmail/">more</a></p>
        </section>
        <article class="article intro"></article>
        <header>
          <h2><a href="/articles/A%20better%20Getmail%20IDLE%20client/">A Better Getmail IDLE client</a></h2>
          <div class="date"><span>10. October 2013</span></div>
          <p class="author"><span class="author"><a href="mailto:w.rouesnel@gmail.com">Will Rouesnel</a></span>
          </p>
        </header>
        <section class="content"><h1>Updates</h1>
<p>(2013-10-15) And like that I‘ve broken it again. Fixing the crash on <span class="caps">IMAP</span> disconnect actually broke IMAP disconnect handling.
The problem here is that IMAPClient’s exceptions are not documented at all, so a time-based thing like IDLE requires some guessing as to what IMAPClient will handle and what you need to handle. This would all be fine if there was a way to get Gmail to boot my client after 30 seconds so I could test it&nbsp;easily.</p>
<p>I&#39;ve amended the code so that anytime the code would call <code>_imaplogin()</code> it explicitely dumps the IMAPClient object after trying to log it out, and recreates it. Near as I can tell this seems to be the safe way to do it, since the IMAPClient object <em>does</em> open a socket connection when created, and doesn&#39;t necessarily re-open if you simply re-issue the login&nbsp;command.</p>
<p>There&#39;s an ongoing lesson here that doing anything that needs to stay up with protocol like <span class="caps">IMAP</span> is an incredible&nbsp;pain.</p>
<p>(2013-10-14) So after 4 days of continuous usage I‘m happy with this script. The most important thing it does is crash properly when it encounters a bug. I’ve tweaked the Gist a few times in response (a typo meant imaplogin didn&#39;t recover gracefully) and added a call to <code>notify_mail</code> on exit which should&#39;ve been there to start&nbsp;with.</p>
<p>It‘s also becoming abundantly clear that I’m way to click-happy with publishing things to this blog, so some type of interface to show my revisions is probably in the future (a long with a style&nbsp;overhaul).</p>
<h1>Why</h1>
<p>My previous attempt at a GetMail <span class="caps">IDLE</span> client was a huge disappointment, since imaplib2 seems to be buggy for handling long-running processes. It‘s possible some magic in hard terminating the IMAP session after each IDLE termination is necessary, but it raises the question of why the idle() function in the library doesn’t immediately exit when this happens - to me that implies I could still end up with a zombie daemon that doesn&#39;t retreive any&nbsp;mail.</p>
<p>Thus a new project - this time based on the Python <code>imapclient</code> library. imapclient uses imaplib behind the scenes, and seems to enjoy a little bit more use then <code>imaplib2</code> so it seemed a good&nbsp;candidate.</p>
<h1>The&nbsp;script</h1>

          <p class="more"><a href="/articles/A%20better%20Getmail%20IDLE%20client/">more</a></p>
        </section>
        <article class="article intro"></article>
        <header>
          <h2><a href="/articles/Getmail%20IDLE%20Client/">A GetMail IDLE daemon script</a></h2>
          <div class="date"><span>05. October 2013</span></div>
          <p class="author"><span class="author"><a href="mailto:w.rouesnel@gmail.com">Will Rouesnel</a></span>
          </p>
        </header>
        <section class="content"><h1>Updates</h1>
<p>Although the script in this article works, I&#39;m having some problems with it after long-running sessions. The symptom seems to be that imaplib2 just stops processing <span class="caps">IDLE</span> session responses - it terminates and recreates them just fine, but no new mail is ever detected and thus getmail is never triggered. With 12 or so hours of usage out of the script, this seems odd as hell and probably like an imaplib2&nbsp;bug.</p>
<p>With the amount of sunk time on this, I‘m tempted to go in 1 of 2 directions: re-tool the script to simply invoke getmail’s <span class="caps">IDLE</span> functionality, and basically remove imaplib2 from the equation, or to write my own functions to read IMAP and use the IDLE&nbsp;command.</p>
<p>Currently I‘m going with option 3: turn on imaplib’s debugging to max, and see if I can spot the bug - but at the moment I can‘t really recommend this particular approach to anyone since it’s just not reliable enough - though it does somewhat belie the fact that Python really doesn&#39;t have a good <span class="caps">IMAP</span> IDLE&nbsp;library.</p>

          <p class="more"><a href="/articles/Getmail%20IDLE%20Client/">more</a></p>
        </section>
        <article class="article intro"></article>
        <header>
          <h2><a href="/articles/Setting%20up%20sshttp/">Setting up sshttp</a></h2>
          <div class="date"><span>27. August 2013</span></div>
          <p class="author"><span class="author"><a href="mailto:w.rouesnel@gmail.com">Will Rouesnel</a></span>
          </p>
        </header>
        <section class="content"><p>When I was travelling Europe I found some surprisingly restricted wi-fi hotspots in hotels. This was annoying because I use <span class="caps">SSH</span> to upload photos back home from my phone, but having not setup any tunneling helpers I just had to wait till I found a better&nbsp;one.</p>
<p>There are a number of solutions to <span class="caps">SSH</span> tunneling, but the main thing I wanted to do was implement something which would let me run several fallbacks at once. Enter <a href="https://github.com/stealth/sshttp">sshttp</a>.</p>
<p>sshttp is related to sslh, in the sense that they are both <span class="caps">SSH</span> connection multiplexers. The idea is that you point a web-browser at port 80, you get a web-page. You point your SSH client, and you get an SSH connection. Naive firewalls let the SSH traffic through without&nbsp;complaint.</p>
<p>The benefit of sshttp over sslh is that it uses Linux&#39;s <code>IP_TRANSPARENT</code> flag, which means that your <span class="caps">SSH</span> and HTTP logs all show proper source IPs, which is great for auditing and&nbsp;security.</p>
<p>This is a blog about how I set it up for my specific server case, the instructions I used as a guide were adapted from <a href="http://blog.stalkr.net/2012/02/sshhttps-multiplexing-with-sshttp.html">here</a>.</p>

          <p class="more"><a href="/articles/Setting%20up%20sshttp/">more</a></p>
        </section>
        <article class="article intro"></article>
        <header>
          <h2><a href="/articles/Upstart%20troubles/">Upstart script not recognized</a></h2>
          <div class="date"><span>26. August 2013</span></div>
          <p class="author"><span class="author"><a href="mailto:w.rouesnel@gmail.com">Will Rouesnel</a></span>
          </p>
        </header>
        <section class="content"><p>I frequently find myself writing upstart scripts which checkout ok, but for some reason don&#39;t get detected by the upstart daemon in the init directory, so when I run <code>start myscript</code> I get <code>unknown job</code> back. Some experimentation seems to indicate that the problem is I used gedit over <span class="caps">GVFS</span> SFTP to author a lot of these&nbsp;scripts.</p>
<p>For something like <code>myscript.conf</code>, I find the following fixes this&nbsp;problem:</p>
<pre><code>mv myscript.conf myscript.conf.d
mv myscript.conf.d myscript.conf</code></pre>
<p>And then hey presto, the script works&nbsp;perfectly.</p>
<p>Along the same lines, the <code>init-checkconf</code> utility isn‘t mentioned enough for upstart debugging - my last post shows I clearly didn’t know about it. Using it is&nbsp;simple:</p>
<pre><code>$ init-checkconf /etc/init/myscript.conf</code></pre>
<p>Note it needs to be run as a regular user. I&#39;m often logged in as root, so sudo&nbsp;suffices:</p>
<pre><code>$ sudo -u nobody init-checkconf /etc/init/myscript.conf</code></pre>

        </section>
        <article class="article intro"></article>
        <header>
          <h2><a href="/articles/Wintersmithing/">Wintersmithing</a></h2>
          <div class="date"><span>18. August 2013</span></div>
          <p class="author"><span class="author"><a href="mailto:w.rouesnel@gmail.com">Will Rouesnel</a></span>
          </p>
        </header>
        <section class="content"><h1>Wintersmith</h1>
<p>How to setup and use Wintersmith is covered pretty thoroughly elsewhere on the net, (namely the <a href="http://wintersmith.io/">wintersmith homepage</a>.</p>
<p>Instead I&#39;ll cover a few tweaks I had to do to get it running the way I wanted. To avoid being truly confusing, all the paths referenced here are relative to the site you create by running <code>wintersmith new &lt;your site dir here&gt;</code></p>

          <p class="more"><a href="/articles/Wintersmithing/">more</a></p>
        </section>
      </div>
    </div>
    <footer>
      <div class="content-wrap">
        <div class="nav"><a href="/archive.html">« Archives</a>
        </div>
        <section class="about">
        </section>
        <section class="copy">
          <p>&copy; 2014 Will Rouesnel &mdash; powered by&nbsp;<a href="https://github.com/jnordberg/wintersmith">Wintersmith</a>
          </p>
        </section>
      </div>
    </footer>
  </body>
</html>